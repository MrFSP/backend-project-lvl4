mixin list(items)
  table.table.table-striped.table-bordered.table-sm
    each item in items
      tr
        td= t(`${item.name}`)

mixin settingForm(properties, type)
  form#settings(
    action=route('settings')
    method='post'
  )
    .text-center
      h5=t(`views.tasks.settings.${type}.name`)
      +list(properties)
    .form-group
      label(
        for='formControlInput'
      )= t(`views.tasks.settings.${type}.add`)
      input#formControlInput.form-control(
        name=`${type}[name]`
        autocomplete='off'
      )
  .d-flex
    button.btn.btn-block.btn-outline-primary(
              form='settings'
            )= t('views.tasks.settings.add')

//- mixins for

mixin oldtask(task)
  input#FormControlInput1.form-control.data-bv-notempty-message(
    name='oldTask'
    value=task
    type='hidden'
  )

mixin inputTaskName(taskName = '')
  .form-group
    label(
      for='FormControlInput1'
    )= t('views.tasks.change.taskName')
    input#FormControlInput1.form-control.data-bv-notempty-message(
      name='task[name]'
      autocomplete='off'
      value=taskName
    )

mixin selectTaskStatus(taskStatus)
  .form-group.col.mb-3.pl-0
    .row.ml-0
      label(
        for='inlineFormCustomSelect'
      )= t('views.tasks.change.status')
      if !taskStatus
        a.h6.btn-link.ml-4.mt-1.mb-1(
          href=route('settings'),
          method='get',
        )= t('views.tasks.settings.add')
    select#inlineFormCustomSelect.flex-row.w-auto.form-control(name='task[status]')
      if taskStatus
        option.form-control(
          value=taskStatus
          selected=''
        )= t(`${taskStatus}`)
      each taskStatus in taskStatuses
        option.form-control(
          value=taskStatus.name
        )= t(`${taskStatus.name}`)

mixin selectedTags(tags)
  each tag in tags
    .form-check
      input.form-check-input(
        type='checkbox'
        id=`${tag.name}`
        name='tagsForTask[name]'
        value=tag.name
        checked=''
      )
      label.form-check-label(
        for=`${tag.name}`
      )= t(`${tag.name}`)

mixin selectTags(taskTags)
  .form-group.col.mb-2.pl-0
    label.mb-1= t('views.tasks.settings.tags')
    .row.ml-0
      if taskTags
        +selectedTags(taskTags)
      each tag in tags
        .form-check.ml-2
          input.form-check-input.pt-1(
            type='checkbox'
            id=`${tag.name}`
            name='tagsForTask[name]'
            value=tag.name
          )
          label.form-check-label(
            for=`${tag.name}`
          )= t(`${tag.name}`)
      if !taskTags
        a.h6.btn-link.ml-4.mt-1.mb-1(
          href=route('settings'),
          method='get',
        )= t('views.tasks.settings.add')

mixin selectAssignedTo(assignedTo)
  .form-group
    select#inlineFormCustomSelect.w-100.form-control(
      name='task[assignedTo]'
      required=''
    )
      if assignedTo
        option.form-control(
          name='assignedTo[id]'
          value=`${assignedTo}`
          selected=''
        )= t(`${users[assignedTo] ? users[assignedTo].fullName : ''}`)
      if !assignedTo
        option(
          selected=''
          disabled=''
        )= t('views.tasks.change.assignedto')
      each user in users
        if user.id != assignedTo
          option.form-control(
            name='assignedTo[id]'
            value=user.id
          )= t(`${user.fullName}`)

mixin btnTag(tag)
  button.btn.badge.badge-pill.badge-success.ml-1.mr-1(
    type='submit'
    form=`myTaskTag${tag.name}`
  ) !{tag.name}
    form(
      action=route('tasks')
      method='post'
      id=`myTaskTag${tag.name}`
    )
      input(
        name='filter[tag]'
        value=tag.id
        type='hidden'
      )

mixin btnTaskStatus(task)
  button.btn.badge.badge-primary.ml-1.mr-1()(
    type='submit'
    form=`myTaskStatus${task.status}`
  ) !{task.status}
    form(
      action=route('tasks')
      method='post'
      id=`myTaskStatus${task.status}`
    )
      input(
        name='filter[taskStatus]'
        value=task.status
        type='hidden'
      )

mixin btnAssignedToFilter(task, users)
  button.h6.btn.btn-link.text-dark.my-0.py-0.ml-1.px-0(
    type='submit'
    form=`myTaskAssignedTo${task.assignedTo}`
  ) !{users[task.assignedTo] ? users[task.assignedTo].fullName : ''}
    form(
      action=route('tasks')
      method='post'
      id=`myTaskAssignedTo${task.assignedTo}`
    )
      input(
        name='filter[assignedTo]'
        value=task.assignedTo
        type='hidden'
      )

mixin taskCard(task)
  div(id=`accordion${task.id}`)
          .card
            .card-header.row.ml-0.mr-0.pt-0.pb-1.justify-content-between(
              id=`heading${task.id}`
            )
              .col.ml-0.mr-0
                .row
                  .mb-0
                    .btn.btn-link.collapsed(
                      data-toggle='collapse'
                      data-target=`#collapse${task.id}`
                      aria-expanded='false'
                      aria-controls=`collapse${task.id}`
                    )= t(task.name)
                  span.d-flex.align-items-center
                    +btnTaskStatus(task)
                .d-flex.align-items-center
                  h6.ml-0.my-0= t('views.tasks.tasks.assignedTo')
                  +btnAssignedToFilter(task, users)
              .row.ml-0.mr-0
                span.d-flex.align-items-top.mt-1
                  .col
                    each tag in task.tags
                      +btnTag(tag)
                .col
                  button.btn.btn-link.btn-sm.text-primary.mt-1(
                    type='submit'
                    form=`formForTaskChange${task.id}`
                  )= t('views.tasks.tasks.change')
                  form(
                    action=route('changeTask')
                    method='get'
                    id=`formForTaskChange${task.id}`
                  )
                    input(
                      name='taskId'
                      value=task.id
                      type='hidden'
                    )
                  button.btn.btn-link.btn-sm.text-danger(
                    type='submit'
                    form=`formForDeleteTask${task.id}`
                    onclick="return confirm('Вы уверены что хотите удалить задачу?')"
                  )= t('views.tasks.tasks.delete')
                  form(
                    action=route('tasks')
                    method='post'
                    id=`formForDeleteTask${task.id}`
                  )
                    input(
                      name='taskID'
                      value=task.id
                      type='hidden'
                    )
                    input(
                      name="_method"
                      type="hidden"
                      value='delete'
                    )
            .collapse(
              aria-labelledby=`heading${task.id}`
              data-parent=`#accordion${task.id}`
              id=`collapse${task.id}`
            )
              .card-body.mt-0.pt-2.p.pb-0.ml-3.pl-3 !{task.description}
              .card-body.pb-1
                .d-flex.justify-content-end
                  h6= t('views.tasks.tasks.author')
                  h6 : !{users[task.creator] ? users[task.creator].fullName : ''}

mixin filterByUser(users)
  .form-group.col-md-4.mb-2
    select.form-control(name='filter[assignedTo]')
      option.form-control(
        selected=''
        disabled=''
        value=''
      )= t('views.tasks.tasks.assignedTo')
      each user in Object.values(users)
        option.form-control(
          value=user.id
        )= t(`${user.fullName}`)

mixin filterByTaskStatus(taskStatuses)
  .form-group.col-md-4.mb-2
    select.form-control(name='filter[taskStatus]')
      option.form-control(
        selected=''
        disabled=''
        value=''
      )= t('views.tasks.change.status')
      each taskStatus in taskStatuses
        option.form-control(
          value=taskStatus.name
        )= t(`${taskStatus.name}`)

mixin filterByTag(tags)
  .form-group.col-md-4.mb-2
    select.form-control(name='filter[tag]')
      option.form-control(
        selected=''
        disabled=''
        value=''
      )= t('views.tasks.tasks.tag')
      each tag in tags
        option.form-control(
          value=tag.id
        )= t(`${tag.name}`)